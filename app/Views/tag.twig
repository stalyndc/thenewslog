{% extends 'layout.twig' %}
{% import 'partials/icons.twig' as icons %}

{% set current_nav = 'tags' %}

{% block title %}{{ tag.name }} — Topics — The News Log{% endblock %}

{% block content %}
<section class="card card--edition">
    <header class="card__header">
        <div class="badge">Tag • {{ tag.name }}</div>
        <h2>Curated Links</h2>
    </header>

    {% if items %}
        <ul class="list-links">
            {% for link in items %}
                <li class="list-links__item{% if link.is_pinned %} list-links__item--pinned{% endif %}">
                    {% if link.is_pinned %}
                        <span class="link-pin" role="img" aria-label="Pinned link" title="Pinned link">
                            {{ icons.pin() }}
                        </span>
                    {% endif %}
                    <div class="list-links__title-row">
                        <a class="link-title" href="{{ link.source_url ?? link.url }}" target="_blank" rel="noopener">
                            {{ link.title }}
                        </a>
                        <a class="link-source" href="{{ link.source_url ?? link.url }}" target="_blank" rel="noopener" aria-label="Read source for {{ link.title }}">
                            {{ icons.external_link('icon--external') }}
                        </a>
                    </div>
                    {% if link.source_name %}
                        <span class="badge badge--muted">{{ link.source_name }}</span>
                    {% endif %}
                    {% if link.published_at %}
                        <span class="time-badge" data-time="{{ link.published_at }}">{{ link.published_at }}</span>
                    {% endif %}
                    {% if link.blurb_html %}
                        <div class="blurb">{{ link.blurb_html|raw }}</div>
                    {% elseif link.blurb %}
                        <p>{{ link.blurb }}</p>
                    {% endif %}
                    {% set linkTags = tagsByLink[link.id]|default([]) %}
                    {% if linkTags %}
                        <div class="tag-list">
                            {% for currentTag in linkTags %}
                                <a class="tag-pill {% if currentTag.id == tag.id %}tag-pill--active{% endif %}" href="/tags/{{ currentTag.slug }}">#{{ currentTag.name }}</a>
                            {% endfor %}
                        </div>
                    {% endif %}
                </li>
            {% endfor %}
        </ul>

        {% if total_pages > 1 %}
            <nav class="pagination">
                {% if page > 1 %}
                    <a class="pagination__link" href="?page={{ page - 1 }}">Previous</a>
                {% endif %}
                <span class="pagination__status">Page {{ page }} of {{ total_pages }}</span>
                {% if page < total_pages %}
                    <a class="pagination__link" href="?page={{ page + 1 }}">Next</a>
                {% endif %}
            </nav>
        {% endif %}
    {% else %}
        <div class="empty-state">
            <p>No curated links yet for {{ tag.name }}.</p>
        </div>
    {% endif %}
</section>
{% endblock %}
