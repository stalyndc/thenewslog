{% extends 'layout.twig' %}

{% set current_nav = 'admin' %}

{% block title %}Edit Post — The News Log{% endblock %}

{% block content %}
<section class="card">
    <div class="badge">Edit Post</div>
    <h2>Edit Post</h2>

    {% if error %}
        <div class="alert alert--error" data-auto-dismiss="10000">{{ error }}</div>
    {% endif %}

    {% if message %}
        <div class="alert alert--success" data-auto-dismiss="10000">{{ message }}</div>
    {% endif %}

    <form method="post" class="form" x-data="{ title: '{{ form.title|default('')|e('js') }}', blurb: '{{ form.blurb|default('')|e('js') }}', date: '{{ form.edition_date|default('')|e('js') }}' }">
        {{ csrf_field() }}

        <div class="form-group">
            <label for="title">Title</label>
            <input id="title" name="title" type="text" class="input-control" x-model="title" value="{{ form.title|default('') }}" required>
        </div>

        <div class="form-group">
            <label for="blurb-editor">Body <span class="form-hint" data-wordcount>0/250 words</span></label>
            <input type="hidden" id="blurb_html" name="blurb_html" value="{{ form.blurb_html|default('')|raw }}">
            <trix-editor input="blurb_html" data-output-text="blurb" data-word-limit="250" class="trix-content"></trix-editor>
            <input type="hidden" id="blurb" name="blurb" x-model="blurb" value="{{ form.blurb|default('')|e('html') }}">
            <p class="form-hint form-hint--warn" data-wordhint style="display:none">Limit is 250 words.</p>
        </div>

        <div class="form-group">
            <label for="edition_date">Edition Date</label>
            <input id="edition_date" name="edition_date" type="date" class="input-control" x-model="date" value="{{ form.edition_date|default('') }}" required>
        </div>

        <div class="form-group">
            <label for="tags">Tags (comma separated)</label>
            <div
                x-data="tagsField({
                    initial: '{{ form.tags|default('')|e('js') }}',
                    suggestUrl: '/admin/tags/suggest',
                    validateUrl: '/admin/tags/validate',
                    allUrl: '/admin/tags/all'
                })"
                x-init="init()"
                @keydown.escape.window="closeSuggest()"
                @click.outside="open=false"
            >
                <input id="tags"
                       type="text"
                       class="input-control"
                       x-model="inputVal"
                       placeholder="e.g. AI, Startups"
                       autocomplete="off"
                       @input.debounce.200ms="onInput()"
                       @focus="open=true; fetchSuggest(true)"
                       @keydown.enter.prevent="commit()"
                       @keydown="if ($event.key === ',') { $event.preventDefault(); commit(); }"
                       @keydown.backspace="maybePop($event)">

                <div class="chips" x-show="tags.length > 0">
                    <template x-for="(t,i) in tags" :key="t">
                        <span class="chip">
                            <span x-text="t"></span>
                            <button type="button" @click="remove(i)" aria-label="Remove tag">×</button>
                        </span>
                    </template>
                </div>

                <input type="hidden" name="tags" :value="joined()">

                <div id="tag-feedback" x-html="feedbackHtml"></div>

                <div id="tag-suggestions" class="tag-suggest-container" x-show="open" x-cloak x-transition @click="onSuggestClick($event)" x-html="suggestionsHtml"></div>
            </div>
        </div>

        <div class="form-group form-group--inline">
            <label class="checkbox">
                <input type="checkbox" name="publish_now" value="1" {% if form.publish_now %}checked{% endif %}>
                <span>Publish immediately</span>
            </label>
            <label class="checkbox">
                <input type="checkbox" name="is_pinned" value="1" {% if form.is_pinned %}checked{% endif %}>
                <span>Pin this post</span>
            </label>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn btn-primary" :disabled="!title || !date || blurb.length === 0">Save Changes</button>
        </div>
    </form>

    {% if curated %}
        <form method="post" action="/admin/posts/{{ curated.id }}/delete" class="form-inline" data-confirm="Delete this post?">
            {{ csrf_field() }}
            <button type="submit" class="btn btn-secondary">Delete</button>
        </form>
    {% endif %}
</section>
{% endblock %}

