{% extends 'layout.twig' %}

{% set current_nav = 'home' %}

{% block title %}Home — The News Log{% endblock %}

{% block content %}
<section class="card card--edition">
    <header class="card__header">
        <div class="badge">
            Daily Edition
            {% if edition_display and edition_date %}
                — <a class="badge-link" href="/editions/{{ edition_date }}">{{ edition_display }}</a>
            {% endif %}
        </div>
        <h2>Latest Curated Links</h2>
    </header>

    {% if links is defined and links|length > 0 %}
        <ul class="list-links">
            {% for link in links %}
                <li class="list-links__item{% if link.is_pinned %} list-links__item--pinned{% endif %}">
                    {% if link.is_pinned %}
                        <span class="link-pin" role="img" aria-label="Pinned link" title="Pinned link">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M9.75 3.75A2.25 2.25 0 0 1 12 1.5a2.25 2.25 0 0 1 2.25 2.25v5.19l1.72 1.72a.75.75 0 0 1-.53 1.28h-2.44v5.78l-.71 2.13-.71-2.13v-5.78H8.56a.75.75 0 0 1-.53-1.28l1.72-1.72z" />
                            </svg>
                        </span>
                    {% endif %}
                    <div class="list-links__title-row">
                        <a class="link-title" href="{{ link.source_url ?? link.url }}" target="_blank" rel="noopener">
                            {{ link.title }}
                        </a>
                        <a class="link-source" href="{{ link.source_url ?? link.url }}" target="_blank" rel="noopener" aria-label="Read source for {{ link.title }}">↗</a>
                    </div>
                    {% if link.source_name %}
                        <span class="badge badge--muted">{{ link.source_name }}</span>
                    {% endif %}
                    {% if link.blurb %}
                        <p>{{ link.blurb }}</p>
                    {% endif %}
                    {% if is_admin|default(false) %}
                        <div class="link-admin-actions">
                            <a class="link-icon" href="/admin/curate/{{ link.item_id ?? link.id }}" aria-label="Edit blurb">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536M9 11.25l6.232-6.232a2.25 2.25 0 013.182 3.182L12.182 14.432a4.5 4.5 0 01-1.697 1.07L8.25 16.5l.998-2.236a4.5 4.5 0 011.07-1.697z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 19.5H4.5A1.5 1.5 0 013 18V4.5A1.5 1.5 0 014.5 3h7.5" />
                                </svg>
                            </a>
                            {% if link.item_id is defined %}
                                <form method="post" action="/admin/curate/{{ link.item_id }}/delete" class="link-admin-actions__form" onsubmit="return confirm('Delete this post?');">
                                    {{ csrf_field() }}
                                    <button type="submit" class="link-icon" aria-label="Delete post">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.02.166m-1.02-.166L19.5 19.5a1.5 1.5 0 01-1.493 1.5H6.993A1.5 1.5 0 015.5 19.5L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .563c.338-.059.678-.114 1.02-.165m0 0L4.772 5.79m0 0a48.11 48.11 0 013.478-.397m0 0l.166-1.32A1.125 1.125 0 0110.528 3h2.944c.552 0 1.02.405 1.107.948l.166 1.32m-6.345 0h6.345" />
                                        </svg>
                                    </button>
                                </form>
                            {% endif %}
                        </div>
                    {% endif %}
                    {% set linkTags = tagsByLink[link.id]|default([]) %}
                    {% if linkTags %}
                        <div class="tag-list">
                            {% for tag in linkTags %}
                                <a class="tag-pill" href="/tags/{{ tag.slug }}">#{{ tag.name }}</a>
                            {% endfor %}
                        </div>
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <div class="empty-state">
            <p>No curated links published yet. Check back soon.</p>
        </div>
    {% endif %}
</section>
{% endblock %}
