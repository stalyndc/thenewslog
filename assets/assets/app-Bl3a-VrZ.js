function I(e){const n=new Date(e);if(Number.isNaN(n.getTime()))return e;const t=Math.max(0,Date.now()-n.getTime());if(t<36e5){const i=Math.floor(t/6e4)||0;return i<=1?"1 min ago":`${i} min ago`}if(t<864e5){const i=Math.floor(t/36e5);return i<=1?"1 hr ago":`${i} hrs ago`}const o=Math.floor(t/864e5);return o<=1?"1 day ago":`${o} days ago`}function B(){document.querySelectorAll("[data-time]").forEach(e=>{if(e.dataset.timeBound==="1")return;e.dataset.timeBound="1";const n=e.dataset.time;if(!n)return;const t=()=>{e.textContent=I(n)};t();const o=window.setInterval(t,6e4);e.addEventListener("htmx:beforeSwap",()=>window.clearInterval(o),{once:!0})})}function q(e){const n=document.getElementById(e);if(n)return n;const t=document.createElement("div");return t.id=e,t.className="toast-stack",t.setAttribute("aria-live","polite"),document.body.appendChild(t),t}function N(e,n,t={}){const o=t.variant??"info",i=document.createElement("div");i.className=`toast toast--${o}`;const a=document.createElement("span");if(a.textContent=n,i.appendChild(a),t.onAction&&t.actionLabel){const r=document.createElement("button");r.type="button",r.textContent=t.actionLabel,r.addEventListener("click",()=>{t.onAction&&t.onAction(),i.remove()}),i.appendChild(r)}e.appendChild(i);const s=t.timeout??6e3;s>0&&window.setTimeout(()=>{i.classList.add("is-hidden"),window.setTimeout(()=>i.remove(),400)},s)}function S(e,n,t={}){const o=q(e);o&&N(o,n,t)}let u=null,y=null,f=null,m=!1,g=null,v={},l=null,L=!1;function p(e){const n={};return Array.from(e.querySelectorAll("[data-id]")).forEach((o,i)=>{const a=o.dataset.id;a&&(n[a]=i+1)}),n}function A(e,n){const t=Object.keys(e);return t.length!==Object.keys(n).length?!1:t.every(o=>e[o]===n[o])}function _(e){Array.from(e.querySelectorAll("[data-order-input]")).forEach((t,o)=>{t.value=String(o+1)})}function k(e,n){Array.from(e.querySelectorAll("[data-id]")).sort((o,i)=>{const a=o.dataset.id??"",s=i.dataset.id??"";return(n[a]??Number.MAX_SAFE_INTEGER)-(n[s]??Number.MAX_SAFE_INTEGER)}).forEach(o=>e.appendChild(o)),_(e)}function x(e,n){const t={};return Object.entries(e).forEach(([o,i])=>{t[`${n}[${o}]`]=String(i)}),t}function w(e,n){if(!u||!y||A(e,v))return;if(m){g={current:e,previous:n};return}const t={};f!=null&&f.value&&(t._token=f.value),Object.assign(t,x(e,"positions")),n&&Object.assign(t,x(n,"previous_positions")),m=!0;const o=htmx.ajax("POST",y,{values:t,target:"#edition-toast",swap:"none"});o&&o.addEventListener?o.addEventListener("loadend",()=>{if(m=!1,v={...e},g){const i=g;g=null,w(i.current,i.previous)}}):m=!1}function C(){if(!u||!l)return;const e=p(u),n={...l};k(u,n),w(n,e),l=null}function O(){L||(L=!0,document.body.addEventListener("edition:order-saved",e=>{if(u||(u=document.querySelector("[data-reorder-list]")),!u)return;const t=e.detail??{};l=t.undo?{...t.undo}:null;const o=t.message??"Edition order updated.",i=t.variant??"info";S("edition-toast",o,{variant:i,actionLabel:l?"Undo":void 0,onAction:l?()=>C():null})}))}function D(){const e=document.querySelector("[data-reorder-list]");if(!e||e.dataset.reorderBound==="1")return;const n=e.dataset.reorderEndpoint;if(!n)return;O(),e.dataset.reorderBound="1",u=e,y=n;const t=e.closest("form");f=(t==null?void 0:t.querySelector('input[name="_token"]'))??null,v=p(e);let o=null,i={...v};Array.from(e.querySelectorAll("[data-id]")).forEach(s=>{s.draggable=!0,s.addEventListener("dragstart",()=>{o=s,i=p(e),s.classList.add("is-dragging")}),s.addEventListener("dragend",()=>{s.classList.remove("is-dragging"),o=null,_(e);const r=p(e);A(r,i)||w(r,i)}),s.addEventListener("dragover",r=>{r.preventDefault();const d=r.currentTarget;if(!o||o===d)return;const c=d.getBoundingClientRect(),b=r.clientY-c.top<c.height/2;e.insertBefore(o,b?d:d.nextSibling)})})}function M(){document.querySelectorAll(".alert[data-auto-dismiss]").forEach(n=>{if(n.dataset.dismissBound==="1")return;const t=parseInt(n.dataset.autoDismiss||"",10);Number.isNaN(t)||t<=0||(n.dataset.dismissBound="1",window.setTimeout(()=>{n.classList.add("is-hidden"),window.setTimeout(()=>{n.remove()},400)},t))})}function H(){window.__editionInfiniteBound||(window.__editionInfiniteBound=!0,document.body.addEventListener("editions:page-loaded",e=>{const t=e.detail??{},o=document.getElementById("edition-list");if(o&&(typeof t.page=="number"&&(o.dataset.editionsCurrent=String(t.page)),!t.next)){const i=document.querySelector(".pagination--fallback");i&&i.classList.add("is-hidden")}}))}function U(){window.__inboxBound||(window.__inboxBound=!0,document.body.addEventListener("inbox:updated",e=>{const t=e.detail??{},o=document.getElementById("inbox-after-id"),i=document.getElementById("inbox-table-body"),a=document.getElementById("admin-inbox-link"),s=a&&a.dataset.inboxCount?Number(a.dataset.inboxCount):0;if(typeof t.latest_id=="number"&&o){const r=Number(o.value||"0");t.latest_id>r&&(o.value=String(t.latest_id))}if(i&&typeof t.latest_id=="number"&&(i.dataset.latestId=String(t.latest_id)),a&&typeof t.count=="number"&&(a.dataset.inboxCount=String(t.count),a.textContent=t.count>0?`Inbox (${t.count})`:"Inbox"),a&&typeof t.count=="number"&&t.count>s){const r=t.count-s;S("inbox-toast",r===1?"1 new inbox item ready.":`${r} new inbox items ready.`,{variant:"info",timeout:5e3})}}))}function R(e){return e.split(",").map(n=>n.trim()).filter(n=>n.length>0)}function j(e){return e.join(", ")}function h(){const e=document.getElementById("tag-validator");e&&typeof htmx<"u"&&htmx.trigger(e,"validate-tags")}function $(){const e=document.querySelector("[data-tags-input]");!e||e.dataset.helperBound==="1"||(e.dataset.helperBound="1",e.setAttribute("autocomplete","off"),typeof htmx<"u"&&document.addEventListener("htmx:beforeRequest",n=>{const o=n.detail||{};if(o.verb==="GET"&&o.path&&o.path.includes("/admin/tags/suggest")){const a=e.value.split(",").map(d=>d.trim()),s=a[a.length-1],r=a.length>1?a.slice(0,-1).join(", "):"";if(o.xhr&&typeof o.xhr.open=="function"){const d=new URL(o.path,window.location.origin);d.searchParams.set("tags",s),d.searchParams.set("existing",r),o.path=d.pathname+d.search}}}),e.addEventListener("blur",()=>{window.setTimeout(()=>{h()},150)}),e.addEventListener("change",()=>{h()}),window.__tagSuggestionHandler||(window.__tagSuggestionHandler=!0,document.addEventListener("click",n=>{const t=n.target,o=t.closest(".tag-suggestion"),i=document.querySelector("[data-tags-input]"),a=document.getElementById("tag-suggestions");if(!(!i||!a)){if(o){const s=o.dataset.tagName;if(!s)return;const r=R(i.value);r.some(c=>c.toLowerCase()===s.toLowerCase())||(r.push(s),i.value=j(r),i.dispatchEvent(new Event("change",{bubbles:!0}))),a.innerHTML="",i.focus(),h();return}!t.closest("#tag-suggestions")&&!t.closest("[data-tags-input]")&&(a.innerHTML="")}})))}function P(){const e=document.querySelector(".app-nav"),n=document.querySelector("[data-mobile-drawer]");if(!e||!n)return;const t=n.querySelector(".drawer-nav__inner");if(!t)return;const o=Array.from(t.querySelectorAll("a")),i=a=>o.filter(s=>s.getAttribute("href")===a);e.querySelectorAll("a").forEach(a=>{const s=a.getAttribute("href");if(!s)return;let r=i(s);if(r.length===0){const c=a.cloneNode(!0);c.classList.add("mobile-link"),t.appendChild(c),r=[c],o.push(c)}else r.forEach(c=>{c.classList.add("mobile-link")});const d=a.classList.contains("is-active");r.forEach(c=>{c.classList.toggle("is-active",d)})})}function F(){const e=document.querySelector("[data-nav-toggle]"),n=document.querySelector("[data-mobile-drawer]"),t=document.querySelector("[data-mobile-drawer-overlay]");if(!e||!n||e.dataset.navBound==="1")return;e.dataset.navBound="1";const o=document.body,i=()=>n.classList.contains("is-open"),a=d=>{e.setAttribute("aria-expanded",d?"true":"false"),n.classList.toggle("is-open",d),t&&t.classList.toggle("is-open",d),o.classList.toggle("is-mobile-nav-open",d)},s=()=>{i()&&a(!1)},r=()=>{i()||a(!0)};e.addEventListener("click",d=>{d.preventDefault(),i()?s():r()}),n.querySelectorAll("a").forEach(d=>{d.addEventListener("click",()=>{s()})}),t&&t.addEventListener("click",d=>{d.preventDefault(),s()}),window.__mobileNavDocumentHandlers||(window.__mobileNavDocumentHandlers=!0,document.addEventListener("click",d=>{const c=d.target,b=c?c.closest("[data-mobile-drawer]"):null,T=c?c.closest("[data-nav-toggle]"):null;!b&&!T&&s()}),document.addEventListener("keydown",d=>{d.key==="Escape"&&s()}))}function Y(){P(),B(),D(),M(),H(),U(),$(),F()}const E=()=>{Y()};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",E,{once:!0}):E();document.addEventListener("htmx:afterSwap",()=>{E()});document.addEventListener("click",e=>{const t=e.target.closest("[data-copy]");if(!t)return;const o=t.dataset.copy;o&&navigator.clipboard.writeText(o).catch(()=>{})});document.addEventListener("keydown",e=>{if(e.key==="Escape"){const n=document.getElementById("tag-suggestions");n&&(n.innerHTML="")}});
