function $(t){const n=new Date(t);if(Number.isNaN(n.getTime()))return t;const e=Math.max(0,Date.now()-n.getTime());if(e<36e5){const i=Math.floor(e/6e4)||0;return i<=1?"1 min ago":`${i} min ago`}if(e<864e5){const i=Math.floor(e/36e5);return i<=1?"1 hr ago":`${i} hrs ago`}const o=Math.floor(e/864e5);return o<=1?"1 day ago":`${o} days ago`}function V(){document.querySelectorAll("[data-time]").forEach(t=>{if(t.dataset.timeBound==="1")return;t.dataset.timeBound="1";const n=t.dataset.time;if(!n)return;const e=()=>{t.textContent=$(n)};e();const o=window.setInterval(e,6e4);t.addEventListener("htmx:beforeSwap",()=>window.clearInterval(o),{once:!0})})}function j(t){const n=document.getElementById(t);if(n)return n;const e=document.createElement("div");return e.id=t,e.className="toast-stack",e.setAttribute("aria-live","polite"),document.body.appendChild(e),e}function F(t,n,e={}){const o=e.variant??"info",i=document.createElement("div");i.className=`toast toast--${o}`;const a=document.createElement("span");if(a.textContent=n,i.appendChild(a),e.onAction&&e.actionLabel){const s=document.createElement("button");s.type="button",s.textContent=e.actionLabel,s.addEventListener("click",()=>{e.onAction&&e.onAction(),i.remove()}),i.appendChild(s)}t.appendChild(i);const r=e.timeout??6e3;r>0&&window.setTimeout(()=>{i.classList.add("is-hidden"),window.setTimeout(()=>i.remove(),400)},r)}function M(t,n,e={}){const o=j(t);o&&F(o,n,e)}let l=null,T=null,v=null,y=!1,E=null,S={},m=null,O=!1;function L(t){const n={};return Array.from(t.querySelectorAll("[data-id]")).forEach((o,i)=>{const a=o.dataset.id;a&&(n[a]=i+1)}),n}function U(t,n){const e=Object.keys(t);return e.length!==Object.keys(n).length?!1:e.every(o=>t[o]===n[o])}function H(t){Array.from(t.querySelectorAll("[data-order-input]")).forEach((e,o)=>{e.value=String(o+1)})}function X(t,n){Array.from(t.querySelectorAll("[data-id]")).sort((o,i)=>{const a=o.dataset.id??"",r=i.dataset.id??"";return(n[a]??Number.MAX_SAFE_INTEGER)-(n[r]??Number.MAX_SAFE_INTEGER)}).forEach(o=>t.appendChild(o)),H(t)}function D(t,n){const e={};return Object.entries(t).forEach(([o,i])=>{e[`${n}[${o}]`]=String(i)}),e}function k(t,n){if(!l||!T||U(t,S))return;if(y){E={current:t,previous:n};return}const e={};v!=null&&v.value&&(e._token=v.value),Object.assign(e,D(t,"positions")),n&&Object.assign(e,D(n,"previous_positions")),y=!0;const o=htmx.ajax("POST",T,{values:e,target:"#edition-toast",swap:"none"});o&&o.addEventListener?o.addEventListener("loadend",()=>{if(y=!1,S={...t},E){const i=E;E=null,k(i.current,i.previous)}}):y=!1}function P(){if(!l||!m)return;const t=L(l),n={...m};X(l,n),k(n,t),m=null}function Y(){O||(O=!0,document.body.addEventListener("edition:order-saved",t=>{if(l||(l=document.querySelector("[data-reorder-list]")),!l)return;const e=t.detail??{};m=e.undo?{...e.undo}:null;const o=e.message??"Edition order updated.",i=e.variant??"info";M("edition-toast",o,{variant:i,actionLabel:m?"Undo":void 0,onAction:m?()=>P():null})}))}function G(){const t=document.querySelector("[data-reorder-list]");if(!t||t.dataset.reorderBound==="1")return;const n=t.dataset.reorderEndpoint;if(!n)return;Y(),t.dataset.reorderBound="1",l=t,T=n;const e=t.closest("form");v=(e==null?void 0:e.querySelector('input[name="_token"]'))??null,S=L(t);let o=null,i={...S};Array.from(t.querySelectorAll("[data-id]")).forEach(r=>{r.draggable=!0,r.addEventListener("dragstart",()=>{o=r,i=L(t),r.classList.add("is-dragging")}),r.addEventListener("dragend",()=>{r.classList.remove("is-dragging"),o=null,H(t);const s=L(t);U(s,i)||k(s,i)}),r.addEventListener("dragover",s=>{s.preventDefault();const d=s.currentTarget;if(!o||o===d)return;const c=d.getBoundingClientRect(),f=s.clientY-c.top<c.height/2;t.insertBefore(o,f?d:d.nextSibling)})})}function W(){document.querySelectorAll(".alert[data-auto-dismiss]").forEach(n=>{if(n.dataset.dismissBound==="1")return;const e=parseInt(n.dataset.autoDismiss||"",10);Number.isNaN(e)||e<=0||(n.dataset.dismissBound="1",window.setTimeout(()=>{n.classList.add("is-hidden"),window.setTimeout(()=>{n.remove()},400)},e))})}function z(){window.__editionInfiniteBound||(window.__editionInfiniteBound=!0,document.body.addEventListener("editions:page-loaded",t=>{const e=t.detail??{},o=document.getElementById("edition-list");if(o&&(typeof e.page=="number"&&(o.dataset.editionsCurrent=String(e.page)),!e.next)){const i=document.querySelector(".pagination--fallback");i&&i.classList.add("is-hidden")}}))}function J(){window.__inboxBound||(window.__inboxBound=!0,document.body.addEventListener("inbox:updated",t=>{const e=t.detail??{},o=document.getElementById("inbox-after-id"),i=document.getElementById("inbox-table-body"),a=document.getElementById("admin-inbox-link"),r=a&&a.dataset.inboxCount?Number(a.dataset.inboxCount):0;if(typeof e.latest_id=="number"&&o){const s=Number(o.value||"0");e.latest_id>s&&(o.value=String(e.latest_id))}if(i&&typeof e.latest_id=="number"&&(i.dataset.latestId=String(e.latest_id)),a&&typeof e.count=="number"&&(a.dataset.inboxCount=String(e.count),a.textContent=e.count>0?`Inbox (${e.count})`:"Inbox"),a&&typeof e.count=="number"&&e.count>r){const s=e.count-r;M("inbox-toast",s===1?"1 new inbox item ready.":`${s} new inbox items ready.`,{variant:"info",timeout:5e3})}}))}let g=null,I="/admin/tags/suggest",_="/admin/tags/validate",u=null,p=null,x="",q="";function B(){return g&&document.body.contains(g)||(g=document.querySelector("[data-tags-input]")??null),g}function N(){return document.getElementById("tag-suggestions")}function K(){return document.getElementById("tag-feedback")}function Q(t){return t.split(",").map(n=>n.trim()).filter(n=>n.length>0)}function Z(t){const n=t.split(",").map(i=>i.trim());if(n.length===0)return{active:"",existing:[]};const e=n.pop()??"",o=n.filter(i=>i.length>0);return{active:e,existing:o}}function tt(t){return t.join(", ")}function w(){u&&(u.abort(),u=null);const t=N();t&&(t.innerHTML=""),x=""}function A(t=!1){const n=B(),e=N();if(!n||!e)return;const o=n.value;if(o.trim()===""){w();return}if(!t&&o===x)return;u&&u.abort();const a=Z(o),r=new URLSearchParams;r.set("tags",a.active),r.set("tags_full",o),a.existing.length>0&&r.set("existing",a.existing.join(", ")),u=new AbortController,fetch(`${I}?${r.toString()}`,{credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"text/html"},signal:u.signal}).then(s=>{if(!s.ok)throw new Error(`Failed to fetch tag suggestions: ${s.status}`);return s.text()}).then(s=>{e.innerHTML=s,x=o}).catch(s=>{s.name!=="AbortError"&&(console.error("Tag suggestion fetch failed",s),w())}).finally(()=>{u=null})}function h(t=!1){const n=B(),e=K();if(!n||!e)return;const o=n.value;if(!t&&o===q)return;p&&p.abort();const i=new URLSearchParams;i.set("tags",o),p=new AbortController,fetch(`${_}?${i.toString()}`,{credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"text/html"},signal:p.signal}).then(a=>{if(!a.ok)throw new Error(`Failed to validate tags: ${a.status}`);return a.text()}).then(a=>{e.innerHTML=a,q=o}).catch(a=>{a.name!=="AbortError"&&console.error("Tag validation fetch failed",a)}).finally(()=>{p=null})}function et(){const t=document.querySelector("[data-tags-input]");if(!t||t.dataset.helperBound==="1")return;g=t,I=t.dataset.tagsSuggestUrl??I,_=t.dataset.tagsValidateUrl??_,x="",q="",t.dataset.helperBound="1",t.setAttribute("autocomplete","off"),t.addEventListener("blur",()=>{window.setTimeout(()=>{h()},150)}),t.addEventListener("change",()=>{h(!0)});let n,e;const o=()=>{typeof n<"u"&&window.clearTimeout(n),n=window.setTimeout(()=>{h()},250)},i=()=>{typeof e<"u"&&window.clearTimeout(e),e=window.setTimeout(()=>{A()},150)};t.addEventListener("input",()=>{o(),i()}),t.addEventListener("focus",()=>{A(!0)}),h(!0),window.__tagSuggestionHandler||(window.__tagSuggestionHandler=!0,document.addEventListener("click",a=>{const r=a.target,s=r.closest(".tag-suggestion"),d=B(),c=N();if(!(!d||!c)){if(s){const f=s.dataset.tagName;if(!f)return;const b=Q(d.value);b.some(R=>R.toLowerCase()===f.toLowerCase())||(b.push(f),d.value=tt(b),d.dispatchEvent(new Event("change",{bubbles:!0}))),w(),d.focus(),h(!0),A(!0);return}!r.closest("#tag-suggestions")&&!r.closest("[data-tags-input]")&&w()}}))}function nt(){const t=document.querySelector(".app-nav"),n=document.querySelector("[data-mobile-drawer]");if(!t||!n)return;const e=n.querySelector(".drawer-nav__inner");if(!e)return;const o=Array.from(e.querySelectorAll("a")),i=a=>o.filter(r=>r.getAttribute("href")===a);t.querySelectorAll("a").forEach(a=>{const r=a.getAttribute("href");if(!r)return;let s=i(r);if(s.length===0){const c=a.cloneNode(!0);c.classList.add("mobile-link"),e.appendChild(c),s=[c],o.push(c)}else s.forEach(c=>{c.classList.add("mobile-link")});const d=a.classList.contains("is-active");s.forEach(c=>{c.classList.toggle("is-active",d)})})}function ot(){const t=document.querySelector("[data-nav-toggle]"),n=document.querySelector("[data-mobile-drawer]"),e=document.querySelector("[data-mobile-drawer-overlay]");if(!t||!n||t.dataset.navBound==="1")return;t.dataset.navBound="1";const o=document.body,i=()=>n.classList.contains("is-open"),a=d=>{t.setAttribute("aria-expanded",d?"true":"false"),n.classList.toggle("is-open",d),e&&e.classList.toggle("is-open",d),o.classList.toggle("is-mobile-nav-open",d)},r=()=>{i()&&a(!1)},s=()=>{i()||a(!0)};t.addEventListener("click",d=>{d.preventDefault(),i()?r():s()}),n.querySelectorAll("a").forEach(d=>{d.addEventListener("click",()=>{r()})}),e&&e.addEventListener("click",d=>{d.preventDefault(),r()}),window.__mobileNavDocumentHandlers||(window.__mobileNavDocumentHandlers=!0,document.addEventListener("click",d=>{const c=d.target,f=c?c.closest("[data-mobile-drawer]"):null,b=c?c.closest("[data-nav-toggle]"):null;!f&&!b&&r()}),document.addEventListener("keydown",d=>{d.key==="Escape"&&r()}))}function it(){nt(),V(),G(),W(),z(),J(),et(),ot()}const C=()=>{it()};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",C,{once:!0}):C();document.addEventListener("htmx:afterSwap",()=>{C()});document.addEventListener("click",t=>{const e=t.target.closest("[data-copy]");if(!e)return;const o=e.dataset.copy;o&&navigator.clipboard.writeText(o).catch(()=>{})});document.addEventListener("keydown",t=>{t.key==="Escape"&&w()});
