function B(t){const n=new Date(t);if(Number.isNaN(n.getTime()))return t;const e=Math.max(0,Date.now()-n.getTime());if(e<36e5){const i=Math.floor(e/6e4)||0;return i<=1?"1 min ago":`${i} min ago`}if(e<864e5){const i=Math.floor(e/36e5);return i<=1?"1 hr ago":`${i} hrs ago`}const o=Math.floor(e/864e5);return o<=1?"1 day ago":`${o} days ago`}function I(){document.querySelectorAll("[data-time]").forEach(t=>{if(t.dataset.timeBound==="1")return;t.dataset.timeBound="1";const n=t.dataset.time;if(!n)return;const e=()=>{t.textContent=B(n)};e();const o=window.setInterval(e,6e4);t.addEventListener("htmx:beforeSwap",()=>window.clearInterval(o),{once:!0})})}function T(t){const n=document.getElementById(t);if(n)return n;const e=document.createElement("div");return e.id=t,e.className="toast-stack",e.setAttribute("aria-live","polite"),document.body.appendChild(e),e}function N(t,n,e={}){const o=e.variant??"info",i=document.createElement("div");i.className=`toast toast--${o}`;const s=document.createElement("span");if(s.textContent=n,i.appendChild(s),e.onAction&&e.actionLabel){const a=document.createElement("button");a.type="button",a.textContent=e.actionLabel,a.addEventListener("click",()=>{e.onAction&&e.onAction(),i.remove()}),i.appendChild(a)}t.appendChild(i);const r=e.timeout??6e3;r>0&&window.setTimeout(()=>{i.classList.add("is-hidden"),window.setTimeout(()=>i.remove(),400)},r)}function x(t,n,e={}){const o=T(t);o&&N(o,n,e)}let u=null,y=null,f=null,m=!1,g=null,p={},l=null,h=!1;function b(t){const n={};return Array.from(t.querySelectorAll("[data-id]")).forEach((o,i)=>{const s=o.dataset.id;s&&(n[s]=i+1)}),n}function S(t,n){const e=Object.keys(t);return e.length!==Object.keys(n).length?!1:e.every(o=>t[o]===n[o])}function A(t){Array.from(t.querySelectorAll("[data-order-input]")).forEach((e,o)=>{e.value=String(o+1)})}function C(t,n){Array.from(t.querySelectorAll("[data-id]")).sort((o,i)=>{const s=o.dataset.id??"",r=i.dataset.id??"";return(n[s]??Number.MAX_SAFE_INTEGER)-(n[r]??Number.MAX_SAFE_INTEGER)}).forEach(o=>t.appendChild(o)),A(t)}function L(t,n){const e={};return Object.entries(t).forEach(([o,i])=>{e[`${n}[${o}]`]=String(i)}),e}function w(t,n){if(!u||!y||S(t,p))return;if(m){g={current:t,previous:n};return}const e={};f!=null&&f.value&&(e._token=f.value),Object.assign(e,L(t,"positions")),n&&Object.assign(e,L(n,"previous_positions")),m=!0;const o=htmx.ajax("POST",y,{values:e,target:"#edition-toast",swap:"none"});o&&o.addEventListener?o.addEventListener("loadend",()=>{if(m=!1,p={...t},g){const i=g;g=null,w(i.current,i.previous)}}):m=!1}function O(){if(!u||!l)return;const t=b(u),n={...l};C(u,n),w(n,t),l=null}function q(){h||(h=!0,document.body.addEventListener("edition:order-saved",t=>{if(u||(u=document.querySelector("[data-reorder-list]")),!u)return;const e=t.detail??{};l=e.undo?{...e.undo}:null;const o=e.message??"Edition order updated.",i=e.variant??"info";x("edition-toast",o,{variant:i,actionLabel:l?"Undo":void 0,onAction:l?()=>O():null})}))}function k(){const t=document.querySelector("[data-reorder-list]");if(!t||t.dataset.reorderBound==="1")return;const n=t.dataset.reorderEndpoint;if(!n)return;q(),t.dataset.reorderBound="1",u=t,y=n;const e=t.closest("form");f=(e==null?void 0:e.querySelector('input[name="_token"]'))??null,p=b(t);let o=null,i={...p};Array.from(t.querySelectorAll("[data-id]")).forEach(r=>{r.draggable=!0,r.addEventListener("dragstart",()=>{o=r,i=b(t),r.classList.add("is-dragging")}),r.addEventListener("dragend",()=>{r.classList.remove("is-dragging"),o=null,A(t);const a=b(t);S(a,i)||w(a,i)}),r.addEventListener("dragover",a=>{a.preventDefault();const d=a.currentTarget;if(!o||o===d)return;const c=d.getBoundingClientRect(),v=a.clientY-c.top<c.height/2;t.insertBefore(o,v?d:d.nextSibling)})})}function M(){document.querySelectorAll(".alert[data-auto-dismiss]").forEach(n=>{if(n.dataset.dismissBound==="1")return;const e=parseInt(n.dataset.autoDismiss||"",10);Number.isNaN(e)||e<=0||(n.dataset.dismissBound="1",window.setTimeout(()=>{n.classList.add("is-hidden"),window.setTimeout(()=>{n.remove()},400)},e))})}function D(){window.__editionInfiniteBound||(window.__editionInfiniteBound=!0,document.body.addEventListener("editions:page-loaded",t=>{const e=t.detail??{},o=document.getElementById("edition-list");if(o&&(typeof e.page=="number"&&(o.dataset.editionsCurrent=String(e.page)),!e.next)){const i=document.querySelector(".pagination--fallback");i&&i.classList.add("is-hidden")}}))}function H(){window.__inboxBound||(window.__inboxBound=!0,document.body.addEventListener("inbox:updated",t=>{const e=t.detail??{},o=document.getElementById("inbox-after-id"),i=document.getElementById("inbox-table-body"),s=document.getElementById("admin-inbox-link"),r=s&&s.dataset.inboxCount?Number(s.dataset.inboxCount):0;if(typeof e.latest_id=="number"&&o){const a=Number(o.value||"0");e.latest_id>a&&(o.value=String(e.latest_id))}if(i&&typeof e.latest_id=="number"&&(i.dataset.latestId=String(e.latest_id)),s&&typeof e.count=="number"&&(s.dataset.inboxCount=String(e.count),s.textContent=e.count>0?`Inbox (${e.count})`:"Inbox"),s&&typeof e.count=="number"&&e.count>r){const a=e.count-r;x("inbox-toast",a===1?"1 new inbox item ready.":`${a} new inbox items ready.`,{variant:"info",timeout:5e3})}}))}function U(t){return t.split(",").map(n=>n.trim()).filter(n=>n.length>0)}function R(t){return t.join(", ")}function E(){const t=document.getElementById("tag-validator");t&&typeof htmx<"u"&&htmx.trigger(t,"validate-tags")}function $(){const t=document.querySelector("[data-tags-input]");!t||t.dataset.helperBound==="1"||(t.dataset.helperBound="1",t.setAttribute("autocomplete","off"),t.addEventListener("blur",()=>{window.setTimeout(()=>{E()},150)}),t.addEventListener("change",()=>{E()}),window.__tagSuggestionHandler||(window.__tagSuggestionHandler=!0,document.addEventListener("click",n=>{const e=n.target,o=e.closest(".tag-suggestion"),i=document.querySelector("[data-tags-input]"),s=document.getElementById("tag-suggestions");if(!(!i||!s)){if(o){const r=o.dataset.tagName;if(!r)return;const a=U(i.value);a.some(c=>c.toLowerCase()===r.toLowerCase())||(a.push(r),i.value=R(a),i.dispatchEvent(new Event("change",{bubbles:!0}))),s.innerHTML="",i.focus(),E();return}!e.closest("#tag-suggestions")&&!e.closest("[data-tags-input]")&&(s.innerHTML="")}})))}function j(){const t=document.querySelector("[data-nav-toggle]"),n=document.querySelector("[data-mobile-drawer]");if(!t||!n||t.dataset.navBound==="1")return;t.dataset.navBound="1";const e=document.body,o=()=>n.classList.contains("is-open"),i=a=>{t.setAttribute("aria-expanded",a?"true":"false"),n.classList.toggle("is-open",a),e.classList.toggle("is-mobile-nav-open",a)},s=()=>{o()&&i(!1)},r=()=>{o()||i(!0)};t.addEventListener("click",a=>{a.preventDefault(),o()?s():r()}),n.querySelectorAll("a").forEach(a=>{a.addEventListener("click",()=>{s()})}),window.__mobileNavDocumentHandlers||(window.__mobileNavDocumentHandlers=!0,document.addEventListener("click",a=>{const d=a.target,c=d?d.closest("[data-mobile-drawer]"):null,v=d?d.closest("[data-nav-toggle]"):null;!c&&!v&&s()}),document.addEventListener("keydown",a=>{a.key==="Escape"&&s()}))}function _(){I(),k(),M(),D(),H(),$(),j()}document.addEventListener("DOMContentLoaded",()=>{_()});document.addEventListener("htmx:afterSwap",()=>{_()});document.addEventListener("click",t=>{const e=t.target.closest("[data-copy]");if(!e)return;const o=e.dataset.copy;o&&navigator.clipboard.writeText(o).catch(()=>{})});document.addEventListener("keydown",t=>{if(t.key==="Escape"){const n=document.getElementById("tag-suggestions");n&&(n.innerHTML="")}});
