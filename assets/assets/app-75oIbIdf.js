function q(t){const n=new Date(t);if(Number.isNaN(n.getTime()))return t;const e=Math.max(0,Date.now()-n.getTime());if(e<36e5){const i=Math.floor(e/6e4)||0;return i<=1?"1 min ago":`${i} min ago`}if(e<864e5){const i=Math.floor(e/36e5);return i<=1?"1 hr ago":`${i} hrs ago`}const o=Math.floor(e/864e5);return o<=1?"1 day ago":`${o} days ago`}function N(){document.querySelectorAll("[data-time]").forEach(t=>{if(t.dataset.timeBound==="1")return;t.dataset.timeBound="1";const n=t.dataset.time;if(!n)return;const e=()=>{t.textContent=q(n)};e();const o=window.setInterval(e,6e4);t.addEventListener("htmx:beforeSwap",()=>window.clearInterval(o),{once:!0})})}function C(t){const n=document.getElementById(t);if(n)return n;const e=document.createElement("div");return e.id=t,e.className="toast-stack",e.setAttribute("aria-live","polite"),document.body.appendChild(e),e}function k(t,n,e={}){const o=e.variant??"info",i=document.createElement("div");i.className=`toast toast--${o}`;const a=document.createElement("span");if(a.textContent=n,i.appendChild(a),e.onAction&&e.actionLabel){const r=document.createElement("button");r.type="button",r.textContent=e.actionLabel,r.addEventListener("click",()=>{e.onAction&&e.onAction(),i.remove()}),i.appendChild(r)}t.appendChild(i);const s=e.timeout??6e3;s>0&&window.setTimeout(()=>{i.classList.add("is-hidden"),window.setTimeout(()=>i.remove(),400)},s)}function I(t,n,e={}){const o=C(t);o&&k(o,n,e)}let u=null,L=null,m=null,b=!1,v=null,h={},g=null,A=!1;function E(t){const n={};return Array.from(t.querySelectorAll("[data-id]")).forEach((o,i)=>{const a=o.dataset.id;a&&(n[a]=i+1)}),n}function B(t,n){const e=Object.keys(t);return e.length!==Object.keys(n).length?!1:e.every(o=>t[o]===n[o])}function T(t){Array.from(t.querySelectorAll("[data-order-input]")).forEach((e,o)=>{e.value=String(o+1)})}function O(t,n){Array.from(t.querySelectorAll("[data-id]")).sort((o,i)=>{const a=o.dataset.id??"",s=i.dataset.id??"";return(n[a]??Number.MAX_SAFE_INTEGER)-(n[s]??Number.MAX_SAFE_INTEGER)}).forEach(o=>t.appendChild(o)),T(t)}function _(t,n){const e={};return Object.entries(t).forEach(([o,i])=>{e[`${n}[${o}]`]=String(i)}),e}function S(t,n){if(!u||!L||B(t,h))return;if(b){v={current:t,previous:n};return}const e={};m!=null&&m.value&&(e._token=m.value),Object.assign(e,_(t,"positions")),n&&Object.assign(e,_(n,"previous_positions")),b=!0;const o=htmx.ajax("POST",L,{values:e,target:"#edition-toast",swap:"none"});o&&o.addEventListener?o.addEventListener("loadend",()=>{if(b=!1,h={...t},v){const i=v;v=null,S(i.current,i.previous)}}):b=!1}function D(){if(!u||!g)return;const t=E(u),n={...g};O(u,n),S(n,t),g=null}function M(){A||(A=!0,document.body.addEventListener("edition:order-saved",t=>{if(u||(u=document.querySelector("[data-reorder-list]")),!u)return;const e=t.detail??{};g=e.undo?{...e.undo}:null;const o=e.message??"Edition order updated.",i=e.variant??"info";I("edition-toast",o,{variant:i,actionLabel:g?"Undo":void 0,onAction:g?()=>D():null})}))}function H(){const t=document.querySelector("[data-reorder-list]");if(!t||t.dataset.reorderBound==="1")return;const n=t.dataset.reorderEndpoint;if(!n)return;M(),t.dataset.reorderBound="1",u=t,L=n;const e=t.closest("form");m=(e==null?void 0:e.querySelector('input[name="_token"]'))??null,h=E(t);let o=null,i={...h};Array.from(t.querySelectorAll("[data-id]")).forEach(s=>{s.draggable=!0,s.addEventListener("dragstart",()=>{o=s,i=E(t),s.classList.add("is-dragging")}),s.addEventListener("dragend",()=>{s.classList.remove("is-dragging"),o=null,T(t);const r=E(t);B(r,i)||S(r,i)}),s.addEventListener("dragover",r=>{r.preventDefault();const d=r.currentTarget;if(!o||o===d)return;const c=d.getBoundingClientRect(),l=r.clientY-c.top<c.height/2;t.insertBefore(o,l?d:d.nextSibling)})})}function U(){document.querySelectorAll(".alert[data-auto-dismiss]").forEach(n=>{if(n.dataset.dismissBound==="1")return;const e=parseInt(n.dataset.autoDismiss||"",10);Number.isNaN(e)||e<=0||(n.dataset.dismissBound="1",window.setTimeout(()=>{n.classList.add("is-hidden"),window.setTimeout(()=>{n.remove()},400)},e))})}function R(){window.__editionInfiniteBound||(window.__editionInfiniteBound=!0,document.body.addEventListener("editions:page-loaded",t=>{const e=t.detail??{},o=document.getElementById("edition-list");if(o&&(typeof e.page=="number"&&(o.dataset.editionsCurrent=String(e.page)),!e.next)){const i=document.querySelector(".pagination--fallback");i&&i.classList.add("is-hidden")}}))}function j(){window.__inboxBound||(window.__inboxBound=!0,document.body.addEventListener("inbox:updated",t=>{const e=t.detail??{},o=document.getElementById("inbox-after-id"),i=document.getElementById("inbox-table-body"),a=document.getElementById("admin-inbox-link"),s=a&&a.dataset.inboxCount?Number(a.dataset.inboxCount):0;if(typeof e.latest_id=="number"&&o){const r=Number(o.value||"0");e.latest_id>r&&(o.value=String(e.latest_id))}if(i&&typeof e.latest_id=="number"&&(i.dataset.latestId=String(e.latest_id)),a&&typeof e.count=="number"&&(a.dataset.inboxCount=String(e.count),a.textContent=e.count>0?`Inbox (${e.count})`:"Inbox"),a&&typeof e.count=="number"&&e.count>s){const r=e.count-s;I("inbox-toast",r===1?"1 new inbox item ready.":`${r} new inbox items ready.`,{variant:"info",timeout:5e3})}}))}function $(t){return t.split(",").map(n=>n.trim()).filter(n=>n.length>0)}function F(t){return t.join(", ")}function y(){const t=document.getElementById("tag-validator");t&&typeof htmx<"u"&&htmx.trigger(t,"validate-tags")}function V(){const t=document.querySelector("[data-tags-input]");if(!t||t.dataset.helperBound==="1")return;t.dataset.helperBound="1",t.setAttribute("autocomplete","off"),t.addEventListener("blur",()=>{window.setTimeout(()=>{y()},150)}),t.addEventListener("change",()=>{y()});let n;const e=()=>{typeof n<"u"&&window.clearTimeout(n),n=window.setTimeout(()=>{y()},250)};t.addEventListener("input",e),window.__tagSuggestionConfigBound||(window.__tagSuggestionConfigBound=!0,document.addEventListener("htmx:configRequest",o=>{const a=o.detail??{},s=typeof a.path=="string"?a.path:"";if((typeof a.verb=="string"?a.verb.toUpperCase():"")!=="GET"||!s.includes("/admin/tags/suggest"))return;const d=document.querySelector("[data-tags-input]");if(!d)return;const c=d.value.split(",").map(w=>w.trim()),l=c.pop()??"",f=c.filter(w=>w.length>0),p=a.parameters??{};p.tags=l,f.length>0?p.existing=f.join(", "):delete p.existing,a.parameters=p})),window.__tagSuggestionHandler||(window.__tagSuggestionHandler=!0,document.addEventListener("click",o=>{const i=o.target,a=i.closest(".tag-suggestion"),s=document.querySelector("[data-tags-input]"),r=document.getElementById("tag-suggestions");if(!(!s||!r)){if(a){const d=a.dataset.tagName;if(!d)return;const c=$(s.value);c.some(f=>f.toLowerCase()===d.toLowerCase())||(c.push(d),s.value=F(c),s.dispatchEvent(new Event("change",{bubbles:!0}))),r.innerHTML="",s.focus(),y();return}!i.closest("#tag-suggestions")&&!i.closest("[data-tags-input]")&&(r.innerHTML="")}}))}function Y(){const t=document.querySelector(".app-nav"),n=document.querySelector("[data-mobile-drawer]");if(!t||!n)return;const e=n.querySelector(".drawer-nav__inner");if(!e)return;const o=Array.from(e.querySelectorAll("a")),i=a=>o.filter(s=>s.getAttribute("href")===a);t.querySelectorAll("a").forEach(a=>{const s=a.getAttribute("href");if(!s)return;let r=i(s);if(r.length===0){const c=a.cloneNode(!0);c.classList.add("mobile-link"),e.appendChild(c),r=[c],o.push(c)}else r.forEach(c=>{c.classList.add("mobile-link")});const d=a.classList.contains("is-active");r.forEach(c=>{c.classList.toggle("is-active",d)})})}function G(){const t=document.querySelector("[data-nav-toggle]"),n=document.querySelector("[data-mobile-drawer]"),e=document.querySelector("[data-mobile-drawer-overlay]");if(!t||!n||t.dataset.navBound==="1")return;t.dataset.navBound="1";const o=document.body,i=()=>n.classList.contains("is-open"),a=d=>{t.setAttribute("aria-expanded",d?"true":"false"),n.classList.toggle("is-open",d),e&&e.classList.toggle("is-open",d),o.classList.toggle("is-mobile-nav-open",d)},s=()=>{i()&&a(!1)},r=()=>{i()||a(!0)};t.addEventListener("click",d=>{d.preventDefault(),i()?s():r()}),n.querySelectorAll("a").forEach(d=>{d.addEventListener("click",()=>{s()})}),e&&e.addEventListener("click",d=>{d.preventDefault(),s()}),window.__mobileNavDocumentHandlers||(window.__mobileNavDocumentHandlers=!0,document.addEventListener("click",d=>{const c=d.target,l=c?c.closest("[data-mobile-drawer]"):null,f=c?c.closest("[data-nav-toggle]"):null;!l&&!f&&s()}),document.addEventListener("keydown",d=>{d.key==="Escape"&&s()}))}function P(){Y(),N(),H(),U(),R(),j(),V(),G()}const x=()=>{P()};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",x,{once:!0}):x();document.addEventListener("htmx:afterSwap",()=>{x()});document.addEventListener("click",t=>{const e=t.target.closest("[data-copy]");if(!e)return;const o=e.dataset.copy;o&&navigator.clipboard.writeText(o).catch(()=>{})});document.addEventListener("keydown",t=>{if(t.key==="Escape"){const n=document.getElementById("tag-suggestions");n&&(n.innerHTML="")}});
