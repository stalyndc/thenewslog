function I(t){const n=new Date(t);if(Number.isNaN(n.getTime()))return t;const e=Math.max(0,Date.now()-n.getTime());if(e<36e5){const i=Math.floor(e/6e4)||0;return i<=1?"1 min ago":`${i} min ago`}if(e<864e5){const i=Math.floor(e/36e5);return i<=1?"1 hr ago":`${i} hrs ago`}const o=Math.floor(e/864e5);return o<=1?"1 day ago":`${o} days ago`}function B(){document.querySelectorAll("[data-time]").forEach(t=>{if(t.dataset.timeBound==="1")return;t.dataset.timeBound="1";const n=t.dataset.time;if(!n)return;const e=()=>{t.textContent=I(n)};e();const o=window.setInterval(e,6e4);t.addEventListener("htmx:beforeSwap",()=>window.clearInterval(o),{once:!0})})}function T(t){const n=document.getElementById(t);if(n)return n;const e=document.createElement("div");return e.id=t,e.className="toast-stack",e.setAttribute("aria-live","polite"),document.body.appendChild(e),e}function N(t,n,e={}){const o=e.variant??"info",i=document.createElement("div");i.className=`toast toast--${o}`;const r=document.createElement("span");if(r.textContent=n,i.appendChild(r),e.onAction&&e.actionLabel){const a=document.createElement("button");a.type="button",a.textContent=e.actionLabel,a.addEventListener("click",()=>{e.onAction&&e.onAction(),i.remove()}),i.appendChild(a)}t.appendChild(i);const s=e.timeout??6e3;s>0&&window.setTimeout(()=>{i.classList.add("is-hidden"),window.setTimeout(()=>i.remove(),400)},s)}function x(t,n,e={}){const o=T(t);o&&N(o,n,e)}let u=null,y=null,f=null,m=!1,g=null,p={},l=null,w=!1;function b(t){const n={};return Array.from(t.querySelectorAll("[data-id]")).forEach((o,i)=>{const r=o.dataset.id;r&&(n[r]=i+1)}),n}function S(t,n){const e=Object.keys(t);return e.length!==Object.keys(n).length?!1:e.every(o=>t[o]===n[o])}function A(t){Array.from(t.querySelectorAll("[data-order-input]")).forEach((e,o)=>{e.value=String(o+1)})}function q(t,n){Array.from(t.querySelectorAll("[data-id]")).sort((o,i)=>{const r=o.dataset.id??"",s=i.dataset.id??"";return(n[r]??Number.MAX_SAFE_INTEGER)-(n[s]??Number.MAX_SAFE_INTEGER)}).forEach(o=>t.appendChild(o)),A(t)}function L(t,n){const e={};return Object.entries(t).forEach(([o,i])=>{e[`${n}[${o}]`]=String(i)}),e}function h(t,n){if(!u||!y||S(t,p))return;if(m){g={current:t,previous:n};return}const e={};f!=null&&f.value&&(e._token=f.value),Object.assign(e,L(t,"positions")),n&&Object.assign(e,L(n,"previous_positions")),m=!0;const o=htmx.ajax("POST",y,{values:e,target:"#edition-toast",swap:"none"});o&&o.addEventListener?o.addEventListener("loadend",()=>{if(m=!1,p={...t},g){const i=g;g=null,h(i.current,i.previous)}}):m=!1}function k(){if(!u||!l)return;const t=b(u),n={...l};q(u,n),h(n,t),l=null}function C(){w||(w=!0,document.body.addEventListener("edition:order-saved",t=>{if(u||(u=document.querySelector("[data-reorder-list]")),!u)return;const e=t.detail??{};l=e.undo?{...e.undo}:null;const o=e.message??"Edition order updated.",i=e.variant??"info";x("edition-toast",o,{variant:i,actionLabel:l?"Undo":void 0,onAction:l?()=>k():null})}))}function O(){const t=document.querySelector("[data-reorder-list]");if(!t||t.dataset.reorderBound==="1")return;const n=t.dataset.reorderEndpoint;if(!n)return;C(),t.dataset.reorderBound="1",u=t,y=n;const e=t.closest("form");f=(e==null?void 0:e.querySelector('input[name="_token"]'))??null,p=b(t);let o=null,i={...p};Array.from(t.querySelectorAll("[data-id]")).forEach(s=>{s.draggable=!0,s.addEventListener("dragstart",()=>{o=s,i=b(t),s.classList.add("is-dragging")}),s.addEventListener("dragend",()=>{s.classList.remove("is-dragging"),o=null,A(t);const a=b(t);S(a,i)||h(a,i)}),s.addEventListener("dragover",a=>{a.preventDefault();const c=a.currentTarget;if(!o||o===c)return;const d=c.getBoundingClientRect(),v=a.clientY-d.top<d.height/2;t.insertBefore(o,v?c:c.nextSibling)})})}function D(){document.querySelectorAll(".alert[data-auto-dismiss]").forEach(n=>{if(n.dataset.dismissBound==="1")return;const e=parseInt(n.dataset.autoDismiss||"",10);Number.isNaN(e)||e<=0||(n.dataset.dismissBound="1",window.setTimeout(()=>{n.classList.add("is-hidden"),window.setTimeout(()=>{n.remove()},400)},e))})}function M(){window.__editionInfiniteBound||(window.__editionInfiniteBound=!0,document.body.addEventListener("editions:page-loaded",t=>{const e=t.detail??{},o=document.getElementById("edition-list");if(o&&(typeof e.page=="number"&&(o.dataset.editionsCurrent=String(e.page)),!e.next)){const i=document.querySelector(".pagination--fallback");i&&i.classList.add("is-hidden")}}))}function H(){window.__inboxBound||(window.__inboxBound=!0,document.body.addEventListener("inbox:updated",t=>{const e=t.detail??{},o=document.getElementById("inbox-after-id"),i=document.getElementById("inbox-table-body"),r=document.getElementById("admin-inbox-link"),s=r&&r.dataset.inboxCount?Number(r.dataset.inboxCount):0;if(typeof e.latest_id=="number"&&o){const a=Number(o.value||"0");e.latest_id>a&&(o.value=String(e.latest_id))}if(i&&typeof e.latest_id=="number"&&(i.dataset.latestId=String(e.latest_id)),r&&typeof e.count=="number"&&(r.dataset.inboxCount=String(e.count),r.textContent=e.count>0?`Inbox (${e.count})`:"Inbox"),r&&typeof e.count=="number"&&e.count>s){const a=e.count-s;x("inbox-toast",a===1?"1 new inbox item ready.":`${a} new inbox items ready.`,{variant:"info",timeout:5e3})}}))}function U(t){return t.split(",").map(n=>n.trim()).filter(n=>n.length>0)}function R(t){return t.join(", ")}function E(){const t=document.getElementById("tag-validator");t&&typeof htmx<"u"&&htmx.trigger(t,"validate-tags")}function $(){const t=document.querySelector("[data-tags-input]");!t||t.dataset.helperBound==="1"||(t.dataset.helperBound="1",t.setAttribute("autocomplete","off"),t.addEventListener("blur",()=>{window.setTimeout(()=>{E()},150)}),t.addEventListener("change",()=>{E()}),window.__tagSuggestionHandler||(window.__tagSuggestionHandler=!0,document.addEventListener("click",n=>{const e=n.target,o=e.closest(".tag-suggestion"),i=document.querySelector("[data-tags-input]"),r=document.getElementById("tag-suggestions");if(!(!i||!r)){if(o){const s=o.dataset.tagName;if(!s)return;const a=U(i.value);a.some(d=>d.toLowerCase()===s.toLowerCase())||(a.push(s),i.value=R(a),i.dispatchEvent(new Event("change",{bubbles:!0}))),r.innerHTML="",i.focus(),E();return}!e.closest("#tag-suggestions")&&!e.closest("[data-tags-input]")&&(r.innerHTML="")}})))}function j(){const t=document.querySelector(".app-nav"),n=document.querySelector("[data-mobile-drawer]");if(!t||!n)return;const e=n.querySelector(".mobile-drawer__inner");if(!e)return;const o=Array.from(e.querySelectorAll("a")),i=r=>o.filter(s=>s.getAttribute("href")===r);t.querySelectorAll("a").forEach(r=>{const s=r.getAttribute("href");if(!s)return;let a=i(s);if(a.length===0){const d=r.cloneNode(!0);d.classList.add("mobile-link"),e.appendChild(d),a=[d],o.push(d)}else a.forEach(d=>{d.classList.add("mobile-link")});const c=r.classList.contains("is-active");a.forEach(d=>{d.classList.toggle("is-active",c)})})}function F(){const t=document.querySelector("[data-nav-toggle]"),n=document.querySelector("[data-mobile-drawer]");if(!t||!n||t.dataset.navBound==="1")return;t.dataset.navBound="1";const e=document.body,o=()=>n.classList.contains("is-open"),i=a=>{t.setAttribute("aria-expanded",a?"true":"false"),n.classList.toggle("is-open",a),e.classList.toggle("is-mobile-nav-open",a)},r=()=>{o()&&i(!1)},s=()=>{o()||i(!0)};t.addEventListener("click",a=>{a.preventDefault(),o()?r():s()}),n.querySelectorAll("a").forEach(a=>{a.addEventListener("click",()=>{r()})}),n.addEventListener("click",a=>{a.target===n&&(a.preventDefault(),r())}),window.__mobileNavDocumentHandlers||(window.__mobileNavDocumentHandlers=!0,document.addEventListener("click",a=>{const c=a.target,d=c?c.closest("[data-mobile-drawer]"):null,v=c?c.closest("[data-nav-toggle]"):null;!d&&!v&&r()}),document.addEventListener("keydown",a=>{a.key==="Escape"&&r()}))}function _(){B(),O(),D(),M(),H(),$(),j(),F()}document.addEventListener("DOMContentLoaded",()=>{_()});document.addEventListener("htmx:afterSwap",()=>{_()});document.addEventListener("click",t=>{const e=t.target.closest("[data-copy]");if(!e)return;const o=e.dataset.copy;o&&navigator.clipboard.writeText(o).catch(()=>{})});document.addEventListener("keydown",t=>{if(t.key==="Escape"){const n=document.getElementById("tag-suggestions");n&&(n.innerHTML="")}});
