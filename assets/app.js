"use strict";(()=>{function j(t){let n=new Date(t);if(Number.isNaN(n.getTime()))return t;let e=Math.max(0,Date.now()-n.getTime());if(e<36e5){let r=Math.floor(e/6e4)||0;return r<=1?"1 min ago":`${r} min ago`}if(e<864e5){let r=Math.floor(e/36e5);return r<=1?"1 hr ago":`${r} hrs ago`}let o=Math.floor(e/864e5);return o<=1?"1 day ago":`${o} days ago`}function k(){document.querySelectorAll("[data-time]").forEach(t=>{if(t.dataset.timeBound==="1")return;t.dataset.timeBound="1";let n=t.dataset.time;if(!n)return;let e=()=>{t.textContent=j(n)};e();let o=window.setInterval(e,6e4);t.addEventListener("htmx:beforeSwap",()=>window.clearInterval(o),{once:!0})})}function F(t){let n=document.getElementById(t);if(n)return n;let e=document.createElement("div");return e.id=t,e.className="toast-stack",e.setAttribute("aria-live","polite"),document.body.appendChild(e),e}function X(t,n,e={}){let o=e.variant??"info",r=document.createElement("div");r.className=`toast toast--${o}`;let i=document.createElement("span");if(i.textContent=n,r.appendChild(i),e.onAction&&e.actionLabel){let s=document.createElement("button");s.type="button",s.textContent=e.actionLabel,s.addEventListener("click",()=>{e.onAction&&e.onAction(),r.remove()}),r.appendChild(s)}t.appendChild(r);let a=e.timeout??6e3;a>0&&window.setTimeout(()=>{r.classList.add("is-hidden"),window.setTimeout(()=>r.remove(),400)},a)}function h(t,n,e={}){let o=F(t);o&&X(o,n,e)}var u=null,x=null,H=null,L=!1,y=null,w={},g=null,q=!1;function T(t){let n={};return Array.from(t.querySelectorAll("[data-id]")).forEach((o,r)=>{let i=o.dataset.id;i&&(n[i]=r+1)}),n}function D(t,n){let e=Object.keys(t);return e.length!==Object.keys(n).length?!1:e.every(o=>t[o]===n[o])}function U(t){Array.from(t.querySelectorAll("[data-order-input]")).forEach((e,o)=>{e.value=String(o+1)})}function P(t,n){Array.from(t.querySelectorAll("[data-id]")).sort((o,r)=>{let i=o.dataset.id??"",a=r.dataset.id??"";return(n[i]??Number.MAX_SAFE_INTEGER)-(n[a]??Number.MAX_SAFE_INTEGER)}).forEach(o=>t.appendChild(o)),U(t)}function N(t,n){let e={};return Object.entries(t).forEach(([o,r])=>{e[`${n}[${o}]`]=String(r)}),e}function A(t,n){if(!u||!x||D(t,w))return;if(L){y={current:t,previous:n};return}let e={};H?.value&&(e._token=H.value),Object.assign(e,N(t,"positions")),n&&Object.assign(e,N(n,"previous_positions")),L=!0;let o=htmx.ajax("POST",x,{values:e,target:"#edition-toast",swap:"none"});o&&o.addEventListener?o.addEventListener("loadend",()=>{if(L=!1,w={...t},y){let r=y;y=null,A(r.current,r.previous)}}):L=!1}function Y(){if(!u||!g)return;let t=T(u),n={...g};P(u,n),A(n,t),g=null}function G(){q||(q=!0,document.body.addEventListener("edition:order-saved",t=>{if(u||(u=document.querySelector("[data-reorder-list]")),!u)return;let e=t.detail??{};g=e.undo?{...e.undo}:null;let o=e.message??"Edition order updated.",r=e.variant??"info";h("edition-toast",o,{variant:r,actionLabel:g?"Undo":void 0,onAction:g?()=>Y():null})}))}function $(){let t=document.querySelector("[data-reorder-list]");if(!t||t.dataset.reorderBound==="1")return;let n=t.dataset.reorderEndpoint;if(!n)return;G(),t.dataset.reorderBound="1",u=t,x=n,H=t.closest("form")?.querySelector('input[name="_token"]')??null,w=T(t);let o=null,r={...w};Array.from(t.querySelectorAll("[data-id]")).forEach(a=>{a.draggable=!0,a.addEventListener("dragstart",()=>{o=a,r=T(t),a.classList.add("is-dragging")}),a.addEventListener("dragend",()=>{a.classList.remove("is-dragging"),o=null,U(t);let s=T(t);D(s,r)||A(s,r)}),a.addEventListener("dragover",s=>{s.preventDefault();let d=s.currentTarget;if(!o||o===d)return;let l=d.getBoundingClientRect(),m=s.clientY-l.top<l.height/2;t.insertBefore(o,m?d:d.nextSibling)})})}function W(){document.querySelectorAll(".alert[data-auto-dismiss]").forEach(n=>{if(n.dataset.dismissBound==="1")return;let e=parseInt(n.dataset.autoDismiss||"",10);Number.isNaN(e)||e<=0||(n.dataset.dismissBound="1",window.setTimeout(()=>{n.classList.add("is-hidden"),window.setTimeout(()=>{n.remove()},400)},e))})}function z(){window.__editionInfiniteBound||(window.__editionInfiniteBound=!0,document.body.addEventListener("editions:page-loaded",t=>{let e=t.detail??{},o=document.getElementById("edition-list");if(o&&(typeof e.page=="number"&&(o.dataset.editionsCurrent=String(e.page)),!e.next)){let r=document.querySelector(".pagination--fallback");r&&r.classList.add("is-hidden")}}))}function J(){window.__inboxBound||(window.__inboxBound=!0,document.body.addEventListener("inbox:updated",t=>{let e=t.detail??{},o=document.getElementById("inbox-after-id"),r=document.getElementById("inbox-table-body"),i=document.getElementById("admin-inbox-link"),a=i&&i.dataset.inboxCount?Number(i.dataset.inboxCount):0;if(typeof e.latest_id=="number"&&o){let s=Number(o.value||"0");e.latest_id>s&&(o.value=String(e.latest_id))}if(r&&typeof e.latest_id=="number"&&(r.dataset.latestId=String(e.latest_id)),i&&typeof e.count=="number"&&(i.dataset.inboxCount=String(e.count),i.textContent=e.count>0?`Inbox (${e.count})`:"Inbox"),i&&typeof e.count=="number"&&e.count>a){let s=e.count-a;h("inbox-toast",s===1?"1 new inbox item ready.":`${s} new inbox items ready.`,{variant:"info",timeout:5e3})}}))}var f=null,I="/admin/tags/suggest",O="/admin/tags/validate",c=null,E=null,M="",C="";function R(){return f&&document.body.contains(f)||(f=document.querySelector("[data-tags-input]")??null),f}function B(){return document.getElementById("tag-suggestions")}function K(){return document.getElementById("tag-feedback")}function Q(t){return t.split(",").map(n=>n.trim()).filter(n=>n.length>0)}function Z(t){let n=t.split(",").map(r=>r.trim());if(n.length===0)return{active:"",existing:[]};let e=n.pop()??"",o=n.filter(r=>r.length>0);return{active:e,existing:o}}function tt(t){return t.join(", ")}function b(){c&&(c.abort(),c=null);let t=B();t&&(t.innerHTML=""),M=""}function S(t=!1){let n=R(),e=B();if(!n||!e)return;let o=n.value;if(o.trim()===""){b();return}if(!t&&o===M)return;c&&c.abort();let i=Z(o),a=new URLSearchParams;a.set("tags",i.active),a.set("tags_full",o),i.existing.length>0&&a.set("existing",i.existing.join(", ")),c=new AbortController,fetch(`${I}?${a.toString()}`,{credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"text/html"},signal:c.signal}).then(s=>{if(!s.ok)throw new Error(`Failed to fetch tag suggestions: ${s.status}`);return s.text()}).then(s=>{e.innerHTML=s,M=o}).catch(s=>{s.name!=="AbortError"&&(console.error("Tag suggestion fetch failed",s),b())}).finally(()=>{c=null})}function v(t=!1){let n=R(),e=K();if(!n||!e)return;let o=n.value;if(!t&&o===C)return;E&&E.abort();let r=new URLSearchParams;r.set("tags",o),E=new AbortController,fetch(`${O}?${r.toString()}`,{credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"text/html"},signal:E.signal}).then(i=>{if(!i.ok)throw new Error(`Failed to validate tags: ${i.status}`);return i.text()}).then(i=>{e.innerHTML=i,C=o}).catch(i=>{i.name!=="AbortError"&&console.error("Tag validation fetch failed",i)}).finally(()=>{E=null})}function et(){let t=document.querySelector("[data-tags-input]");if(!t||t.dataset.helperBound==="1")return;f=t,I=t.dataset.tagsSuggestUrl??I,O=t.dataset.tagsValidateUrl??O,M="",C="",t.dataset.helperBound="1",t.setAttribute("autocomplete","off"),t.addEventListener("blur",()=>{window.setTimeout(()=>{v()},150)}),t.addEventListener("change",()=>{v(!0)});let n,e,o=()=>{typeof n<"u"&&window.clearTimeout(n),n=window.setTimeout(()=>{v()},250)},r=()=>{typeof e<"u"&&window.clearTimeout(e),e=window.setTimeout(()=>{S()},150)};t.addEventListener("input",()=>{o(),r()}),t.addEventListener("focus",()=>{S(!0)}),v(!0),window.__tagSuggestionHandler||(window.__tagSuggestionHandler=!0,document.addEventListener("click",i=>{let a=i.target,s=a.closest(".tag-suggestion"),d=R(),l=B();if(!(!d||!l)){if(s){let m=s.dataset.tagName;if(!m)return;let p=Q(d.value);p.some(V=>V.toLowerCase()===m.toLowerCase())||(p.push(m),d.value=tt(p),d.dispatchEvent(new Event("change",{bubbles:!0}))),b(),d.focus(),v(!0),S(!0);return}!a.closest("#tag-suggestions")&&!a.closest("[data-tags-input]")&&b()}}))}function nt(){let t=document.querySelector(".app-nav"),n=document.querySelector("[data-mobile-drawer]");if(!t||!n)return;let e=n.querySelector(".drawer-nav__inner");if(!e)return;let o=Array.from(e.querySelectorAll("a")),r=i=>o.filter(a=>a.getAttribute("href")===i);t.querySelectorAll("a").forEach(i=>{let a=i.getAttribute("href");if(!a)return;let s=r(a);if(s.length===0){let l=i.cloneNode(!0);l.classList.add("mobile-link"),e.appendChild(l),s=[l],o.push(l)}else s.forEach(l=>{l.classList.add("mobile-link")});let d=i.classList.contains("is-active");s.forEach(l=>{l.classList.toggle("is-active",d)})})}function ot(){let t=document.querySelector("[data-nav-toggle]"),n=document.querySelector("[data-mobile-drawer]"),e=document.querySelector("[data-mobile-drawer-overlay]");if(!t||!n||t.dataset.navBound==="1")return;t.dataset.navBound="1";let o=document.body,r=()=>n.classList.contains("is-open"),i=d=>{t.setAttribute("aria-expanded",d?"true":"false"),n.classList.toggle("is-open",d),e&&e.classList.toggle("is-open",d),o.classList.toggle("is-mobile-nav-open",d)},a=()=>{r()&&i(!1)},s=()=>{r()||i(!0)};t.addEventListener("click",d=>{d.preventDefault(),r()?a():s()}),n.querySelectorAll("a").forEach(d=>{d.addEventListener("click",()=>{a()})}),e&&e.addEventListener("click",d=>{d.preventDefault(),a()}),window.__mobileNavDocumentHandlers||(window.__mobileNavDocumentHandlers=!0,document.addEventListener("click",d=>{let l=d.target,m=l?l.closest("[data-mobile-drawer]"):null,p=l?l.closest("[data-nav-toggle]"):null;!m&&!p&&a()}),document.addEventListener("keydown",d=>{d.key==="Escape"&&a()}))}function rt(){nt(),k(),$(),W(),z(),J(),et(),ot()}var _=()=>{rt()};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",_,{once:!0}):_();document.addEventListener("htmx:afterSwap",()=>{_()});document.addEventListener("click",t=>{let e=t.target.closest("[data-copy]");if(!e)return;let o=e.dataset.copy;o&&navigator.clipboard.writeText(o).catch(()=>{})});document.addEventListener("keydown",t=>{t.key==="Escape"&&b()});})();
